{{define "title"}}Edit Expense{{end}}
{{define "css"}}/static/css/expenses.css{{end}}

{{define "main"}}
  <div class="expense-view">
    <div class="card-grid gap-8">
      <div class="card">
        <h2>Edit Expense</h2>
        
        {{if gt (len .Error) 0}} 
          {{template "error" .Error}}
        {{end}}
        
        {{if gt (len .Banner) 0}} 
          {{template "banner" .Banner}}
        {{end}}
        
        <form class="expense-form">
          {{if gt (len .FormErrors) 0}}
            <div class="error-summary">
              {{range $field, $message := .FormErrors}}
                <div class="error-message">{{$message}}</div>
              {{end}}
            </div>
          {{end}}
          
          <div class="form-group">
            <label for="expense-source">Source</label>
            {{if index .FormErrors "source"}}
              <input type="text" class="error-input" id="expense-source" 
                name="source" value="{{.Expense.Source}}" required>
              <span class="form-group-error">{{ index .FormErrors "source"}}</span>
            {{else}}
              <input type="text" id="expense-source" 
                name="source" value="{{.Expense.Source}}" required>
            {{end}}
          </div>
          
          <div class="form-group">
            <label for="expense-description">Description</label>
            {{if index .FormErrors "description"}}
              <input type="text" class="error-input" id="expense-description" 
                name="description" value="{{.Expense.Description}}" required>
              <span class="form-group-error">{{ index .FormErrors "description"}}</span>
            {{else}}
              <input type="text" id="expense-description" 
                name="description" value="{{.Expense.Description}}" required>
            {{end}}
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="expense-amount">Amount</label>
              {{if index .FormErrors "amount"}}
                <input type="number" class="error-input" id="expense-amount" 
                  name="amount" value="{{printf "%.2f" (divideFloat .Expense.Amount 100)}}" step="0.01" required>
                <span class="form-group-error">{{ index .FormErrors "amount"}}</span>
              {{else}}
                <input type="number" id="expense-amount" 
                  name="amount" value="{{printf "%.2f" (divideFloat .Expense.Amount 100)}}" step="0.01" required>
              {{end}}
            </div>
            
            <div class="form-group">
              <label for="expense-currency">Currency</label>
              {{if index .FormErrors "currency"}}
                <select class="error-input" id="expense-currency" name="currency" required>
                  <option value="EUR" {{if eq .Expense.Currency "EUR"}}selected{{end}}>EUR (€)</option>
                  <option value="USD" {{if eq .Expense.Currency "USD"}}selected{{end}}>USD ($)</option>
                  <option value="GBP" {{if eq .Expense.Currency "GBP"}}selected{{end}}>GBP (£)</option>
                </select>
                <span class="form-group-error">{{ index .FormErrors "currency"}}</span>
              {{else}}
                <select id="expense-currency" name="currency" required>
                  <option value="EUR" {{if eq .Expense.Currency "EUR"}}selected{{end}}>EUR (€)</option>
                  <option value="USD" {{if eq .Expense.Currency "USD"}}selected{{end}}>USD ($)</option>
                  <option value="GBP" {{if eq .Expense.Currency "GBP"}}selected{{end}}>GBP (£)</option>
                </select>
              {{end}}
            </div>
          </div>
          
          <div class="form-group">
            <label for="expense-date">Date</label>
            {{if index .FormErrors "date"}}
              <input type="date" class="error-input" id="expense-date" 
                name="date" value="{{.Expense.Date.Format "2006-01-02"}}" required>
              <span class="form-group-error">{{ index .FormErrors "date"}}</span>
            {{else}}
              <input type="date" id="expense-date" 
                name="date" value="{{.Expense.Date.Format "2006-01-02"}}" required>
            {{end}}
          </div>
          
          <div class="form-group">
            <label for="expense-type">Type</label>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="type" value="0" {{if eq .Expense.Type 0}}checked{{end}}>
                <span class="radio-text">Expense</span>
              </label>
              <label class="radio-label">
                <input type="radio" name="type" value="1" {{if eq .Expense.Type 1}}checked{{end}}>
                <span class="radio-text">Income</span>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label for="expense-category">Category</label>
            <select id="expense-category" name="category_id">
              <option value="">None</option>
              {{range .Categories}}
                <option value="{{.ID}}" {{if and $.Expense.CategoryID.Valid (eq $.Expense.CategoryID.Int64 .ID)}}selected{{end}}>
                  {{.Name}}
                </option>
              {{end}}
            </select>
          </div>
          
          <div class="form-actions">
            <a href="/expenses" class="btn-secondary">Cancel</a>
            <button class="btn-primary"
                    hx-put="/expense/{{.Expense.ID}}" 
                    hx-target="#page" 
                    hx-swap="outerHTML">
              Save Changes
            </button>
          </div>
        </form>
      </div>
      
      <div class="card">
        <h3>Expense Details</h3>
        <div class="mb-6">
          <div class="expense-info">
            <p><strong>Current Amount:</strong> 
              <span class="amount {{if gt .Expense.Amount 0}}income{{else}}expense{{end}}">
                {{formatMoney .Expense.Amount "." ","}}€
              </span>
            </p>
            <p><strong>Date:</strong> {{.Expense.Date.Format "January 2, 2006"}}</p>
            <p><strong>Source:</strong> {{.Expense.Source}}</p>
            {{if .Expense.CategoryID.Valid}}
              <p><strong>Category:</strong> <span class="badge">{{.Expense.Category}}</span></p>
            {{else}}
              <p><strong>Category:</strong> <span class="text-gray-500">Uncategorized</span></p>
            {{end}}
          </div>
        </div>
        
        <div class="danger-zone">
          <h4>Danger Zone</h4>
          <p class="text-sm text-gray-600 mb-4">Permanently delete this expense. This action cannot be undone.</p>
          
          <a class="btn-danger btn-small" 
                hx-delete="/expense/{{.Expense.ID}}" 
                hx-confirm="Are you sure you want to delete the expense? This action cannot be undone.">
          Delete Expense
        </a>
        </div>
      </div>
    </div>
  </div>
{{end}}
