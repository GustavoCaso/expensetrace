{{define "reports/category"}} 
  {{ $cssClass := "expense" }}
  {{ if gt .Amount 0 }}
    {{ $cssClass ="income" }}
  {{ end }}
  <li class="category-item">
    <div class="category-header">
      <span class="category-name">{{.Name}}</span>
      <span class="category-amount {{$cssClass}}">{{formatMoney .Amount "." ","}}€</span>
    </div>

    {{if and (lt .Amount 0) (gt .Budget.Amount 0)}}
      <!-- Budget progress for expense categories with budgets -->
      <div class="budget-container">
        <div class="budget-info">
          <span class="budget-spent">{{formatMoney .Budget.Spent "." ","}}€</span>
          <span class="budget-separator">/</span>
          <span class="budget-total">{{formatMoney .Budget.Amount "." ","}}€</span>
          <span class="budget-percentage {{.Budget.Status}}">
            ({{printf "%.0f" .Budget.PercentageUsed}}%)
          </span>
        </div>
        <div class="budget-bar">
          <div class="budget-progress budget-{{.Budget.Status}}"
               style="width: {{if gt .Budget.PercentageUsed 100.0}}100{{else}}{{printf "%.0f" .Budget.PercentageUsed}}{{end}}%">
          </div>
        </div>
        {{if lt .Budget.Remaining 0}}
          <div class="budget-warning">
            Over budget by {{formatMoney .Budget.Remaining "." ","}}€
          </div>
        {{else}}
          <div class="budget-remaining">
            {{formatMoney .Budget.Remaining "." ","}}€ remaining
          </div>
        {{end}}
      </div>
    {{end}}

    <button class="btn-small toggle-details" data-target="{{$cssClass}}-details-{{.Name}}">
      <span class="toggle-text">Show Details</span>
    </button>
    <div id="{{$cssClass}}-details-{{.Name}}" class="toggle-content mt-4 collapsed">
      <div class="table">
        <div class="table-header">
          <div class="table-header-cell">Date</div>
          <div class="table-header-cell">Description</div>
          <div class="table-header-cell">Source</div>
          <div class="table-header-cell">Amount</div>
        </div>
        <div class="table-body">
          {{range $expense := .Expenses}}
            <a href="/expense/{{$expense.ID}}" class="table-row">
              <div class="table-cell">{{$expense.Date.Format "2006-01-02"}}</div>
              <div class="table-cell">{{$expense.Description}}</div>
              <div class="table-cell source-column">{{$expense.Source}}</div>
              <div class="table-cell {{$cssClass}}">{{formatMoney $expense.Amount "." ","}}€</div>
            </a>
          {{end}}
        </div>
      </div>
    </div>
  </li>
{{end}}
